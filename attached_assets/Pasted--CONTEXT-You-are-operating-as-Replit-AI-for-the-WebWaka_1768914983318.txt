
â¸»

CONTEXT

You are operating as Replit AI for the WebWaka Modular Rebuild.

This task is Phase 5B: POS UI & Runtime.

You are building the POS application runtime and UI as a pure consumer of existing core and control layers.

ğŸš« You must NOT implement business rules
ğŸš« You must NOT re-implement permissions, entitlements, pricing, inventory logic
ğŸš« You must NOT hardcode roles, plans, or visibility
ğŸš« You must NOT modify core or control repositories

â¸»

SOURCE OF TRUTH

GitHub Organization: ChangerPlanet

Target Repository (MUST CLONE FIRST):
https://github.com/changerplanet/webwaka-suite-pos-ui

â›” HARD STOP
If this repository cannot be cloned:
	â€¢	STOP immediately
	â€¢	Do NOT scaffold locally
	â€¢	Do NOT write any code
	â€¢	Report back that cloning failed

â¸»

WHAT THIS REPO IS

webwaka-suite-pos-ui is:
	â€¢	A POS frontend + runtime
	â€¢	A consumer of:
	â€¢	webwaka-suite-pos-control
	â€¢	webwaka-core-inventory
	â€¢	webwaka-core-ledger
	â€¢	webwaka-core-payments
	â€¢	webwaka-core-receipts
	â€¢	webwaka-core-dashboard-control
	â€¢	A mobile-first, offline-first PWA

This repo contains NO control definitions â€” only UI, runtime orchestration, and offline sync.

â¸»

TECH STACK (LOCKED)
	â€¢	Framework: Next.js 14 (App Router)
	â€¢	Language: TypeScript
	â€¢	Styling: Tailwind CSS
	â€¢	State: Local runtime state only (no business state)
	â€¢	Offline Storage: IndexedDB (Dexie or equivalent)
	â€¢	Testing: Jest + React Testing Library
	â€¢	Deployment: GitHub â†’ Vercel (already configured)

â¸»

ARCHITECTURAL RULES (NON-NEGOTIABLE)

1ï¸âƒ£ Visibility & Access

ALL visibility must come from:
	â€¢	Permissions
	â€¢	Entitlements
	â€¢	Feature Flags

Resolved ONLY via:
	â€¢	webwaka-core-dashboard-control

ğŸš« No if (role === "cashier")
ğŸš« No UI permission checks

â¸»

2ï¸âƒ£ POS Control Consumption

The UI must import and consume:
	â€¢	Capabilities
	â€¢	Entitlements
	â€¢	Feature flags
	â€¢	Dashboard section declarations

From:
	â€¢	webwaka-suite-pos-control

ğŸš« No duplication
ğŸš« No reinterpretation

â¸»

3ï¸âƒ£ Inventory
	â€¢	Read availability from Inventory Core
	â€¢	Write reservations / adjustments via Inventory Core APIs
	â€¢	NEVER mutate stock locally except as optimistic UI

â¸»

4ï¸âƒ£ Ledger & Payments
	â€¢	UI emits events
	â€¢	Ledger computes truth
	â€¢	Payments handled via Core Payments
	â€¢	Receipts generated via Core Receipts

ğŸš« UI must not compute balances
ğŸš« UI must not store money totals as truth

â¸»

5ï¸âƒ£ Offline-First (MANDATORY)

The POS must:
	â€¢	Work with no internet
	â€¢	Queue:
	â€¢	Sales
	â€¢	Inventory reservations
	â€¢	Payments (pending)
	â€¢	Sync deterministically when online
	â€¢	Handle conflict resolution gracefully

Offline is not optional.

â¸»

REQUIRED IMPLEMENTATION SCOPE

A. UI SCREENS
	â€¢	Login / Session bootstrap (mock auth acceptable)
	â€¢	POS Home / Dashboard
	â€¢	Product Search & Quick Sale
	â€¢	Cart
	â€¢	Checkout
	â€¢	Receipt View
	â€¢	Shift Open / Close
	â€¢	Offline / Sync Status Indicator

B. Runtime Layer
	â€¢	Event queue
	â€¢	Sync manager
	â€¢	IndexedDB schema
	â€¢	Snapshot hydration for:
	â€¢	Dashboard
	â€¢	Permissions
	â€¢	Entitlements
	â€¢	Feature flags

C. Dashboard Integration
	â€¢	Consume POS dashboard declaration
	â€¢	Render sections dynamically
	â€¢	Show â€œwhy hiddenâ€ in dev mode

â¸»

TESTING REQUIREMENTS

You must provide tests proving:
	â€¢	UI renders deterministically for same snapshot
	â€¢	Hidden sections never render without entitlement
	â€¢	Offline â†’ online sync replays events correctly
	â€¢	No cross-tenant leakage
	â€¢	POS works in airplane mode (simulated)

Minimum coverage: 80%

â¸»

DELIVERABLES
	1.	Running POS UI in Replit
	2.	All tests passing
	3.	Offline-first verified
	4.	No business logic in UI
	5.	Code pushed to main

â¸»

HARD STOP CONDITION

A real-world scenario must be proven:

â€œA cashier can make sales offline, close a shift, regain internet, and all events reconcile correctly with ledger, inventory, and receipts â€” with UI visibility controlled entirely by core rules.â€

If this is not proven:
	â€¢	STOP
	â€¢	Do NOT claim completion

â¸»

REPORTING FORMAT (REQUIRED)

When complete, report:
	1.	Screens implemented
	2.	Offline guarantees verified
	3.	Control & core modules consumed
	4.	Test summary + coverage
	5.	Vercel deployment URL
	6.	Final commit SHA

â¸»

STOP AFTER COMPLETION

â›” Do NOT proceed to Phase 5C
â›” Await explicit authorization

â¸»

ACKNOWLEDGEMENT

Reply only with:

â€œI acknowledge and will clone the repo before proceeding.â€

Then proceed.